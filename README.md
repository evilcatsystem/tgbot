# tgbot
Модульный бот Python для телеграмм, работающий на python3 с базой данных sqlalchemy.

Первоначально простой бот для управления группами с множеством функций администрирования превратился в основу для модульных
ботов, стремящиеся обеспечить простое расширение плагина с помощью простого перетаскивания.

## Запустить бота.

После того, как вы настроили свою базу данных и ваша конфигурация (см. Ниже) завершена, просто запустите:

`python3 -m tg_bot`


## Настройка бота (прочтите перед использованием!):
Обязательно используйте python3.6, так как я не могу гарантировать, что все будет работать должным образом на более старых версиях python!
Это связано с тем, что синтаксический анализ уценки выполняется путем итерации через dict, которые по умолчанию упорядочены в 3.6.

### Настройка

Есть два возможных способа настройки вашего бота: файл config.py или переменные ENV.

Рекомендуемая версия - использовать файл `config.py`, так как это упрощает просмотр всех ваших настроек, сгруппированных вместе.
Этот файл следует поместить в папку `tg_bot` вместе с файлом `__main __.py`.
Здесь будет загружен ваш токен бота, а также URI вашей базы данных (если вы используете базу данных) и большую часть
другие ваши настройки.

Рекомендуется импортировать sample_config и расширить класс Config, так как это гарантирует, что ваша конфигурация содержит все
значения по умолчанию установлены в sample_config, что упрощает обновление.

Пример файла `config.py` может быть:

```
from tg_bot.sample_config import Config


class Development(Config):
    OWNER_ID = 254318997  # Ваш telegram ID
    OWNER_USERNAME = "SonOfLars"  # Ваш telegram username
    API_KEY = "your bot api key"  # Ваш api key, можете получить у @BotFather
    SQLALCHEMY_DATABASE_URI = 'postgresql://username:password@localhost:5432/database'  # образец учетных данных БД
    MESSAGE_DUMP = '-1234567890' # какой-то групповой чат, участником которого является ваш бот
    USE_MESSAGE_DUMP = True
    SUDO_USERS = [18673980, 83489514]  # Список идентификаторов пользователей, у которых есть доступ sudo к боту.
    LOAD = []
    NO_LOAD = ['translation'] # Образец отключения команд
```

Если у вас не может быть файла config.py (например, на heroku), также можно использовать переменные среды.
Поддерживаются следующие переменные env:
 - `ENV`: Установка этого значения в ANYTHING включит переменные env

 - `TOKEN`: Токен вашего бота.
 - `OWNER_ID`: Ваше айди
 - `OWNER_USERNAME`: Ваш username

 - `DATABASE_URL`: URL вашей базы данных
 - `MESSAGE_DUMP`: необязательно: чат, в котором хранятся ваши сохраненные сообщения, чтобы люди не удаляли свои старые
 - `LOAD`: Список модулей, которые вы хотите загрузить, через пробел
 - `NO_LOAD`: Список модулей, которые вы не хотите загрузить, через пробел
 - `WEBHOOK`: Установка этого значения на ANYTHING включит веб-перехватчики в режиме env.
 Сообщения
 - `URL`: URL-адрес, к которому должен подключиться ваш webhook (требуется только для режима webhook)

 - `SUDO_USERS`: список идентификаторов пользователей, разделенных пробелами, которые следует рассматривать как пользователей sudo
 - `SUPPORT_USERS`: Список user_id, разделенных пробелами, которые следует рассматривать как поддерживающих пользователей (можно gban/ungban,
 ничего больше)
 - `WHITELIST_USERS`: Список идентификаторов пользователей, разделенных пробелами, которые следует считать внесенными в белый список - их нельзя заблокировать.
 - `DONATION_LINK`: Необязательно: ссылка, по которой вы хотите получать пожертвования.
 - `CERT_PATH`: Путь к вашему сертификату webhook
 - `PORT`: Порт для вашего webhooks
 - `DEL_CMDS`: Следует ли удалять команды от пользователей, у которых нет прав на использование этой команды
 - `STRICT_GBAN`: Применяйте gbans как в новых, так и в старых группах. Когда gbanned пользователь заговорит, его забанят.
 - `WORKERS`: Количество используемых потоков. 8 - рекомендуемая (и по умолчанию) сумма, но ваш опыт может отличаться.
 __Note__ может сойти с ума с большим количеством потоков, что не обязательно ускорит работу вашего бота, учитывая большой объем данных sql
 доступы и способ работы асинхронных вызовов Python.
 - `BAN_STICKER`: Какой стикер использовать при бане людей.
 - `ALLOW_EXCL`: Разрешить ли использование восклицательных знаков ! для команд, а также /.

### Зависимости Python

Установите необходимые зависимости Python, перейдя в каталог проекта и запустив:

`pip3 install -r requirements.txt`.

Это установит все необходимые пакеты python

### База данных

Если вы хотите использовать модуль, зависящий от базы данных (например: блокировки, заметки, информация о пользователе, пользователи, фильтры, приветствия),
в вашей системе должна быть установлена ​​база данных. Я использую postgres, поэтому рекомендую использовать его для оптимальной совместимости.

В случае postgres это то, как вы должны настроить базу данных в системе debian / ubuntu. Другие дистрибутивы могут отличаться.

- Установить postgresql:

`sudo apt-get update && sudo apt-get install postgresql`

- изменить на пользователя postgres:

`sudo su - postgres`

- создайте нового пользователя базы данных (измените YOUR_USER соответствующим образом):

`createuser -P -s -e YOUR_USER`

После этого вам нужно будет ввести свой пароль.

- создать новую таблицу базы данных:

`createdb -O YOUR_USER YOUR_DB_NAME`

Измените YOUR_USER и YOUR_DB_NAME соответствующим образом.

- rjytw:

`psql YOUR_DB_NAME -h YOUR_HOST YOUR_USER`

Это позволит вам подключиться к вашей базе данных через терминал.
По умолчанию YOUR_HOST должен быть 0.0.0.0:5432.

Теперь вы можете создать URI своей базы данных. Это будет:

`sqldbtype://username:pw@hostname:port/db_name`

Замените sqldbtype любым используемым вами db (например postgres, mysql, sqllite, etc)
повторить для своего username, password, hostname (localhost?), port (5432?), и db name.

## Модули
### Установка порядка загрузки.

Порядок загрузки модулей можно изменить с помощью параметров конфигурации `LOAD` и `NO_LOAD`.
Оба они должны представлять собой списки

Если `LOAD` - пустой список, все модули в `modules/` будут выбраны для загрузки по умолчанию.

Если `NO_LOAD` отсутствует или является пустым списком, будут загружены все модули, выбранные для загрузки.

Если модуль находится и в `LOAD`, и в `NO_LOAD`, он не будет загружен - приоритет имеет `NO_LOAD`.

### Создание собственных модулей..

Создание модуля было максимально упрощено, но не стесняйтесь предлагать дальнейшее упрощение.

Все, что нужно, - это чтобы ваш файл .py находился в папке модулей.

Чтобы добавить команды, обязательно импортируйте диспетчер через

`from tg_bot import dispatcher`.

Затем вы можете добавлять команды, используя обычные

`dispatcher.add_handler()`.

Назначение переменной `__help__` в строке, описывающей доступные модули
позволят боту загрузить его и добавить документацию для
вашего модуля в команду `/help`. Установка переменной `__mod_name__` также позволит вам использовать более приятный пользовательское
понятное имя для модуля.

Функция `__migrate__()` используется для переноса чатов - когда чат повышается до супергруппы, идентификатор меняется, поэтому
необходимо перенести его в db.

Функция `__stats__()` предназначена для получения статистики модуля, например количества пользователей, количества чатов. Это доступно
с помощью команды `/stats`, доступной только владельцу бота.

## Оригинал

Под основу был взят бот `https://github.com/PaulSonOfLars/tgbot`

Был переведен на русский язык.
Были добавлены некоторые новые команды.
Работа бота происходит только в одном чате.
Изменен модуль rss.
И многое другое
